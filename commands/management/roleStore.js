const a68_0x4a12=['compile','language','NO_ROLES_ON_SALE','membershipLimitPaidRoles','\x20/\x20','author','LIMITED_PREMIUM_MEMBERSHIP','MAX_SAFE_INTEGER','add','buy','save','RED','PremiumTier','user','balance','roleStore\x20ROLE\x20--unlist','catch','IRIS','roleStore','\x20Bastion\x20Coins','PAID_ROLES','unlist','findOneAndUpdate','PLATINUM','isPublicBastion','locale','price','exports','ROLE_NOT_FOR_SALE','Paid\x20Role','getString','findOne','roleStore\x20ROLE\x20--buy','find','roles','error','LIMITS','sell','permissions','roleStore\x20ROLE\x20--sell\x20AMOUNT','constructor','GOLD','guild','member','exec','INSUFFICIENT_BALANCE','roleNotFound','join','has','fetchPremiumTier','errors','default','Command','tag','It\x20allows\x20you\x20to\x20set\x20up\x20a\x20Role\x20Store\x20in\x20the\x20server.\x20Server\x20managers\x20can\x20sell\x20roles\x20in\x20the\x20server\x20and\x20members\x20can\x20buy\x20them\x20with\x20Bastion\x20Coins.','DiscordError','GREEN','length','../../utils/constants','map','roleStoreAdd','document','resolver','roleStoreRemove','send','ROLE_ALREADY_ASSIGNED','ROLE_NOT_FOUND','Constants','debit','_id','countDocuments','BASTION_ERROR_TYPE','name','../../utils/omnic','client','cache','channel','premiumPaidRoles','^([^\x20]+(\x20+[^\x20]+)+)+[^\x20]}','info','MANAGE_ROLES','COLORS','resolveRole','NO_PERMISSION'];(function(_0x1e188f,_0x4a1243){const _0x5c68ae=function(_0xf4e296){while(--_0xf4e296){_0x1e188f['push'](_0x1e188f['shift']());}};const _0x3db015=function(){const _0xb1f753={'data':{'key':'cookie','value':'timeout'},'setCookie':function(_0x52858e,_0x2fdb3e,_0xa6264f,_0x4a1ce9){_0x4a1ce9=_0x4a1ce9||{};let _0x59485f=_0x2fdb3e+'='+_0xa6264f;let _0x579e9b=0x0;for(let _0xb2ddda=0x0,_0x507bc1=_0x52858e['length'];_0xb2ddda<_0x507bc1;_0xb2ddda++){const _0x54f5d4=_0x52858e[_0xb2ddda];_0x59485f+=';\x20'+_0x54f5d4;const _0x17a1f0=_0x52858e[_0x54f5d4];_0x52858e['push'](_0x17a1f0);_0x507bc1=_0x52858e['length'];if(_0x17a1f0!==!![]){_0x59485f+='='+_0x17a1f0;}}_0x4a1ce9['cookie']=_0x59485f;},'removeCookie':function(){return'dev';},'getCookie':function(_0x54d9bc,_0x2714ef){_0x54d9bc=_0x54d9bc||function(_0x3d5531){return _0x3d5531;};const _0x319aa5=_0x54d9bc(new RegExp('(?:^|;\x20)'+_0x2714ef['replace'](/([.$?*|{}()[]\/+^])/g,'$1')+'=([^;]*)'));const _0x5285de=function(_0x2ac8b7,_0x3df6e6){_0x2ac8b7(++_0x3df6e6);};_0x5285de(_0x5c68ae,_0x4a1243);return _0x319aa5?decodeURIComponent(_0x319aa5[0x1]):undefined;}};const _0x45b604=function(){const _0x4a3f4f=new RegExp('\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*[\x27|\x22].+[\x27|\x22];?\x20*}');return _0x4a3f4f['test'](_0xb1f753['removeCookie']['toString']());};_0xb1f753['updateCookie']=_0x45b604;let _0x4f6754='';const _0xda61a7=_0xb1f753['updateCookie']();if(!_0xda61a7){_0xb1f753['setCookie'](['*'],'counter',0x1);}else if(_0xda61a7){_0x4f6754=_0xb1f753['getCookie'](null,'counter');}else{_0xb1f753['removeCookie']();}};_0x3db015();}(a68_0x4a12,0xe2));const a68_0x5c68=function(_0x1e188f,_0x4a1243){_0x1e188f=_0x1e188f-0x0;let _0x5c68ae=a68_0x4a12[_0x1e188f];return _0x5c68ae;};const a68_0xb1f753=function(){let _0x5544a2=!![];return function(_0x1ea382,_0x4721dc){const _0x189cf3=_0x5544a2?function(){if(_0x4721dc){const _0x19437=_0x4721dc['apply'](_0x1ea382,arguments);_0x4721dc=null;return _0x19437;}}:function(){};_0x5544a2=![];return _0x189cf3;};}();const a68_0xf4e296=a68_0xb1f753(this,function(){const _0x2e630f=function(){const _0x2b170e=_0x2e630f[a68_0x5c68('0x42')]('return\x20/\x22\x20+\x20this\x20+\x20\x22/')()[a68_0x5c68('0x1a')](a68_0x5c68('0x14'));return!_0x2b170e['test'](a68_0xf4e296);};return _0x2e630f();});a68_0xf4e296();'use strict';const tesseract_1=require('@bastion/tesseract');const Role_1=require('../../models/Role');const constants=require(a68_0x5c68('0x0'));const errors=require('../../utils/errors');const numbers=require('../../utils/numbers');const omnic=require(a68_0x5c68('0xf'));module[a68_0x5c68('0x35')]=class RoleStoreCommand extends tesseract_1[a68_0x5c68('0x4e')]{constructor(){super(a68_0x5c68('0x2c'),{'description':a68_0x5c68('0x50'),'triggers':[],'arguments':{'boolean':[a68_0x5c68('0x23'),a68_0x5c68('0x2f')],'number':[a68_0x5c68('0x3f')],'coerce':{'sell':_0x68fde5=>numbers['clamp'](_0x68fde5,0x1,Number[a68_0x5c68('0x21')])}},'scope':'guild','owner':![],'cooldown':0x0,'ratelimit':0x1,'clientPermissions':[a68_0x5c68('0x16')],'userPermissions':[],'syntax':[a68_0x5c68('0x2c'),a68_0x5c68('0x41'),a68_0x5c68('0x3a'),a68_0x5c68('0x29')]});this[a68_0x5c68('0x46')]=async(_0x440f93,_0x2e2089)=>{if(_0x2e2089['_'][a68_0x5c68('0x53')]){const _0x4db58a=this[a68_0x5c68('0x10')][a68_0x5c68('0x4')][a68_0x5c68('0x18')](_0x440f93[a68_0x5c68('0x44')],_0x2e2089['_'][a68_0x5c68('0x49')]('\x20'));if(!_0x4db58a)throw new errors['DiscordError'](errors[a68_0x5c68('0xd')][a68_0x5c68('0x8')],this[a68_0x5c68('0x10')][a68_0x5c68('0x33')]['getString'](_0x440f93['guild'][a68_0x5c68('0x3')][a68_0x5c68('0x1b')],a68_0x5c68('0x3d'),a68_0x5c68('0x48')));if(_0x2e2089[a68_0x5c68('0x3f')]>0x0){if(constants[a68_0x5c68('0x32')](this['client'][a68_0x5c68('0x27')])){const _0x429f96=await Role_1[a68_0x5c68('0x4d')][a68_0x5c68('0xc')]({'guild':_0x440f93[a68_0x5c68('0x44')]['id'],'price':{'$exists':!![],'$ne':null}});if(_0x429f96>=constants[a68_0x5c68('0x3e')][a68_0x5c68('0x2e')]){const _0xe00a6a=await omnic[a68_0x5c68('0x4b')](_0x440f93['guild'])[a68_0x5c68('0x2a')](()=>{});if(_0xe00a6a){if(_0xe00a6a===omnic[a68_0x5c68('0x26')][a68_0x5c68('0x43')]&&_0x429f96>=constants[a68_0x5c68('0x3e')][a68_0x5c68('0x43')]['PAID_ROLES']){throw new errors['DiscordError'](errors[a68_0x5c68('0xd')][a68_0x5c68('0x20')],this['client']['locale']['getString'](_0x440f93[a68_0x5c68('0x44')][a68_0x5c68('0x3')][a68_0x5c68('0x1b')],a68_0x5c68('0x4c'),'membershipLimitPaidRoles',constants['LIMITS']['GOLD'][a68_0x5c68('0x2e')]));}else if(_0xe00a6a===omnic[a68_0x5c68('0x26')][a68_0x5c68('0x31')]&&_0x429f96>=constants['LIMITS'][a68_0x5c68('0x31')][a68_0x5c68('0x2e')]){throw new errors[(a68_0x5c68('0x51'))](errors['BASTION_ERROR_TYPE'][a68_0x5c68('0x20')],this[a68_0x5c68('0x10')]['locale'][a68_0x5c68('0x38')](_0x440f93[a68_0x5c68('0x44')]['document'][a68_0x5c68('0x1b')],a68_0x5c68('0x4c'),a68_0x5c68('0x1d'),constants[a68_0x5c68('0x3e')][a68_0x5c68('0x31')][a68_0x5c68('0x2e')]));}}else{throw new errors[(a68_0x5c68('0x51'))](errors[a68_0x5c68('0xd')]['PREMIUM_MEMBERSHIP_REQUIRED'],this[a68_0x5c68('0x10')]['locale'][a68_0x5c68('0x38')](_0x440f93['guild'][a68_0x5c68('0x3')]['language'],a68_0x5c68('0x4c'),a68_0x5c68('0x13'),constants['LIMITS'][a68_0x5c68('0x2e')]));}}}if(!_0x440f93[a68_0x5c68('0x45')][a68_0x5c68('0x40')][a68_0x5c68('0x4a')]('MANAGE_ROLES'))throw new Error(a68_0x5c68('0x19'));await Role_1['default'][a68_0x5c68('0x30')]({'_id':_0x4db58a['id'],'guild':_0x440f93[a68_0x5c68('0x44')]['id']},{'_id':_0x4db58a['id'],'guild':_0x440f93[a68_0x5c68('0x44')]['id'],'price':_0x2e2089[a68_0x5c68('0x3f')]},{'upsert':!![]});return await _0x440f93[a68_0x5c68('0x12')][a68_0x5c68('0x6')]({'embed':{'color':tesseract_1[a68_0x5c68('0x9')]['COLORS'][a68_0x5c68('0x52')],'description':this[a68_0x5c68('0x10')][a68_0x5c68('0x33')][a68_0x5c68('0x38')](_0x440f93[a68_0x5c68('0x44')][a68_0x5c68('0x3')][a68_0x5c68('0x1b')],'info',a68_0x5c68('0x2'),_0x440f93[a68_0x5c68('0x1f')][a68_0x5c68('0x4f')],_0x4db58a['name'],_0x2e2089[a68_0x5c68('0x3f')])}})['catch'](()=>{});}if(_0x2e2089[a68_0x5c68('0x23')]){if(_0x440f93[a68_0x5c68('0x45')][a68_0x5c68('0x3c')][a68_0x5c68('0x11')][a68_0x5c68('0x4a')](_0x4db58a['id']))throw new Error(a68_0x5c68('0x7'));const _0x3af648=await Role_1[a68_0x5c68('0x4d')][a68_0x5c68('0x39')]({'_id':_0x4db58a['id'],'guild':_0x440f93['guild']['id'],'price':{'$exists':!![],'$ne':null}});if(!_0x3af648)throw new Error(a68_0x5c68('0x36'));if(_0x440f93[a68_0x5c68('0x45')]['document'][a68_0x5c68('0x28')]<_0x3af648[a68_0x5c68('0x34')])throw new Error(a68_0x5c68('0x47'));await _0x440f93[a68_0x5c68('0x45')][a68_0x5c68('0x3c')][a68_0x5c68('0x22')](_0x4db58a);_0x440f93[a68_0x5c68('0x45')][a68_0x5c68('0xa')](_0x3af648[a68_0x5c68('0x34')],a68_0x5c68('0x37'),_0x440f93[a68_0x5c68('0x45')][a68_0x5c68('0x3')]);await _0x440f93[a68_0x5c68('0x45')][a68_0x5c68('0x3')][a68_0x5c68('0x24')]();return await _0x440f93[a68_0x5c68('0x12')]['send']({'embed':{'color':tesseract_1[a68_0x5c68('0x9')][a68_0x5c68('0x17')][a68_0x5c68('0x52')],'description':this['client']['locale']['getString'](_0x440f93[a68_0x5c68('0x44')][a68_0x5c68('0x3')][a68_0x5c68('0x1b')],a68_0x5c68('0x15'),'roleBought',_0x440f93[a68_0x5c68('0x1f')][a68_0x5c68('0x4f')],_0x4db58a[a68_0x5c68('0xe')],_0x2e2089[a68_0x5c68('0x3f')])}})[a68_0x5c68('0x2a')](()=>{});}if(_0x2e2089[a68_0x5c68('0x2f')]){if(!_0x440f93[a68_0x5c68('0x45')][a68_0x5c68('0x40')][a68_0x5c68('0x4a')](a68_0x5c68('0x16')))throw new Error('NO_PERMISSION');await Role_1[a68_0x5c68('0x4d')][a68_0x5c68('0x30')]({'_id':_0x4db58a['id'],'guild':_0x440f93['guild']['id'],'price':{'$exists':!![],'$ne':null}},{'_id':_0x4db58a['id'],'guild':_0x440f93[a68_0x5c68('0x44')]['id'],'$unset':{'price':0x1}});return await _0x440f93[a68_0x5c68('0x12')]['send']({'embed':{'color':tesseract_1[a68_0x5c68('0x9')][a68_0x5c68('0x17')][a68_0x5c68('0x25')],'description':this[a68_0x5c68('0x10')][a68_0x5c68('0x33')][a68_0x5c68('0x38')](_0x440f93[a68_0x5c68('0x44')][a68_0x5c68('0x3')][a68_0x5c68('0x1b')],a68_0x5c68('0x15'),a68_0x5c68('0x5'),_0x440f93[a68_0x5c68('0x1f')][a68_0x5c68('0x4f')],_0x4db58a[a68_0x5c68('0xe')])}})['catch'](()=>{});}}const _0x45ba6f=await Role_1['default'][a68_0x5c68('0x3b')]({'guild':_0x440f93[a68_0x5c68('0x44')]['id'],'price':{'$exists':!![],'$ne':null}});if(!_0x45ba6f['length'])throw new Error(a68_0x5c68('0x1c'));return await _0x440f93[a68_0x5c68('0x12')][a68_0x5c68('0x6')]({'embed':{'color':tesseract_1[a68_0x5c68('0x9')][a68_0x5c68('0x17')][a68_0x5c68('0x2b')],'title':'Roles\x20Store','fields':_0x45ba6f[a68_0x5c68('0x1')](_0xb736f2=>({'name':(_0x440f93[a68_0x5c68('0x44')][a68_0x5c68('0x3c')][a68_0x5c68('0x11')]['has'](_0xb736f2[a68_0x5c68('0xb')])?_0x440f93[a68_0x5c68('0x44')][a68_0x5c68('0x3c')][a68_0x5c68('0x11')]['get'](_0xb736f2[a68_0x5c68('0xb')])[a68_0x5c68('0xe')]+a68_0x5c68('0x1e'):'')+_0xb736f2[a68_0x5c68('0xb')],'value':_0xb736f2[a68_0x5c68('0x34')]+a68_0x5c68('0x2d')}))}})[a68_0x5c68('0x2a')](()=>{});};}};